<div
  class="max-w-4xl mx-auto bg-white dark:bg-neutral-800 rounded-lg shadow-lg mb-2 p-2 sm:p-5 border border-neutral-200 dark:border-neutral-700"
>
  <!-- Header -->
  <div class="relative flex-col sm:flex-row sm:items-center align-middle">

    <div class="absolute -top-4 -right-4">
      @if(job.active){
      <mat-icon class="text-green-600 dark:text-green-500"
        >check_circle</mat-icon
      >
      <!-- <h2 class="text-lg font-semibold text-neutral-900 dark:text-neutral-100">Active</h2> -->
      } @else {
      <mat-icon class="text-red-600 dark:text-red-500">cancel</mat-icon>
      <!-- <h2 class="text-lg font-semibold text-neutral-900 dark:text-neutral-100">Inactive</h2> -->
      }
    </div>


    <div class="flex flex-col sm:flex-row sm:items-center gap-3">

      <div class="flex flex-row items-center min-w-0 flex-1">
        <mat-icon class="text-neutral-600 dark:text-neutral-300 flex-shrink-0"
          >assignment_ind</mat-icon
        >
        <h2 class="text-xl truncate pl-2 font-semibold text-neutral-900 dark:text-neutral-100 min-w-0">
          {{ job.name }}
        </h2>
      </div>

      <!-- <p>El string que quiero copiar es: <strong>{{ miVariableConString }}</strong></p> -->
      <div class="">
      @if(!copiedSucces){
      <div
        class="flex flex-row cursor-pointer rounded-lg border py-1 px-2 border-neutral-200 dark:border-neutral-700 bg-neutral-150 dark:bg-neutral-700 text-neutral-700 dark:text-neutral-100"
        (click)="copyMagicString()"
      >
        <mat-icon class="sm:!hidden">wand_stars</mat-icon>
        <div class="pl-2 sm:pl-0 sm:pr-2">{{ "recruiter.magic_link" | transloco }}</div>
        <mat-icon class="!hidden sm:!block">wand_stars</mat-icon>
      </div>
      } @if(copiedSucces){
      <div
        class="flex flex-row rounded-lg border py-1 px-2 border-neutral-200 dark:border-neutral-700 bg-neutral-150 dark:bg-neutral-700 text-neutral-700 dark:text-neutral-100 font-bold"
      >
        <mat-icon>wand_stars</mat-icon>
        <div class="px-2">{{ "recruiter.magic_link_copied" | transloco }}</div>
        <mat-icon>wand_stars</mat-icon>
      </div>
      }
      <!-- @if(errorInCopy){
      <span style="margin-left: 10px; color: red">{{ "recruiter.error_not_copy" | transloco }}</span>
      <span style="margin-left: 10px; color: red">{{ "recruiter.error_not_copy" | transloco }}</span>
      <span style="margin-left: 10px; color: red">{{ this.magicLink }}</span>
      <div class="fixed z-50 top-50 left-0 h-28 w-screen bg-yellow-100">
        <div>
            {{ this.magicLink }}
        </div>
      </div>
      } -->
      @if(errorInCopy){
        <div class="fixed z-50 left-0 top-1/3 h-2/3">
          <div class="m-auto w-11/12 bg-white dark:bg-neutral-800 rounded-lg shadow-xl mb-2 p-2 sm:p-5 border-2 border-neutral-400 dark:border-neutral-600 ">

            <div class="text-center text-red-500">
              {{ "recruiter.browser_not_copy_A" | transloco }}<br>
              {{ "recruiter.browser_not_copy_B" | transloco }}
            </div>

            <div class="break-all p-8">
                {{ this.magicLink }}
            </div>

            <button
              (click)="turnOffManualLink()"
              class="flex m-auto cursor-pointer rounded-lg border py-1 px-2 my-2 border-neutral-200 dark:border-neutral-700 bg-neutral-150 dark:bg-neutral-700 text-neutral-700 dark:text-neutral-100 ml-auto"
            >
              <div>
                {{ "recruiter.i_alredy_copiy_link" | transloco }}
              </div>
                <mat-icon class="text-neutral-600 dark:text-neutral-300 ml-2">done_outline</mat-icon>
                <!-- <mat-icon class="text-neutral-600 dark:text-neutral-300">clinical_notes</mat-icon> -->
            </button>


          </div>

        </div>
      }

      </div>

    </div>
  </div>
  @if(this.examForJob && this.job.examActive){
    <div class="flex items-center flex-col sm:flex-row mt-2 text-neutral-600 dark:text-neutral-300">
      <div class="flex items-center">
        <mat-icon class="">
          quiz
        </mat-icon>
        <div class="pl-2">
        Examen:
        </div>
      </div>
      <div class="sm:pl-2">
        "{{this.examForJob.title}}"
      </div>
    </div>

  }




  <!-- Button to expand Candidates -->
  @if(candidatesForJob.length >= 1) {
  <div class="flex flex-col sm:flex-row gap-3 mt-2 font-light">
    <div
      class="flex items-center cursor-pointer rounded-lg border py-1 px-2 border-neutral-200 dark:border-neutral-700 bg-neutral-150 dark:bg-neutral-700 text-neutral-700 dark:text-neutral-100"
      (click)="switchShowCandidates()"
    >
      <div class="flex">
        <mat-icon class="text-neutral-600 dark:text-neutral-300"
        >group
        </mat-icon>
      </div>
      <div class="flex pl-2">
        {{ "recruiter.candidates" | transloco }} ({{ candidatesForJob.length }})
      </div>
      <div class="flex pl-2 ml-auto">
        @if(!showCandidates) {
        <mat-icon
          class="text-neutral-600 dark:text-neutral-300 items-center align-middle"
          >expand_circle_down</mat-icon
        >
        } @else {
        <mat-icon
          class="text-neutral-600 dark:text-neutral-300 items-center align-middle"
          >expand_circle_up</mat-icon
        >
        }
      </div>
    </div>
  </div>
  }

  <!-- Candidates showing -->
  @if(showCandidates && candidatesForJob.length >= 1){
    <div class="grid grid-cols-1 sm:grid-cols-2 mt-2">
      @for(candidate of candidatesWithScores; track candidate.candidateUID) {
        <div class="sm:flex-row text-neutral-600 dark:text-neutral-300 py-2 px-1 border-b last:border-b-0 sm:border-0 border-neutral-200 dark:border-neutral-700">
          <div class="flex items-center justify-between">
            <div class="flex-grow sm:flex-grow-0 truncate overflow-hidden whitespace-nowrap pr-2">
              • {{ candidate.username }} {{ candidate.lastname }}
            </div>
            <div
              (click)="showResume(candidate)"
              class="flex cursor-pointer rounded-lg border py-1 px-2 border-neutral-200 dark:border-neutral-700 bg-neutral-150 dark:bg-neutral-700 text-neutral-700 dark:text-neutral-100 ml-auto"
            >
              <mat-icon class="text-neutral-600 dark:text-neutral-300">clinical_notes</mat-icon>
              <span class="pl-2 pr-2">{{ 'recruiter.resume' | transloco }}</span>
              @if(candidate.scoreToPosition !== null){
                <span class="">{{ candidate.scoreToPosition / 10 | number:'1.1-1'}}%</span>
              } @else {
                <span class="">"?"</span>
              }
              <!-- @if(candidate.scoreToPosition != "N/A"){
                <span class="">{{ candidate.scoreToPosition / 10 | number:'1.1-1'}}%</span>
              } -->
            </div>
            <div class="sm:grow"></div>
          </div>
        </div>
      }
    </div>
    <!-- @if (selectedResume) {
    <app-resume-viewer
      [resumeForJob]="selectedResume"
      (closeViewer)="selectedResume = null"
    ></app-resume-viewer>
  } -->
  }





  <!-- Button expand EXAM OK -->
  @if(candidatesForJobAndExamPassed.length >= 1) {
  <div class="flex flex-col sm:flex-row gap-3 mt-2">
    <div
      class="flex items-center cursor-pointer rounded-lg border py-1 px-2 border-neutral-200 dark:border-neutral-700 bg-neutral-150 dark:bg-neutral-700 text-neutral-700 dark:text-neutral-100"
      (click)="switchShowCandidatesExamPassed()"
    >
      <div class="flex">
        <mat-icon class="text-neutral-600 dark:text-neutral-300"
        >person_play
        </mat-icon>
      </div>
      <div class="flex pl-2">
        {{ "recruiter.with_test_ok" | transloco }} ({{ candidatesForJobAndExamPassed.length }})
      </div>
      <div class="flex pl-2 ml-auto">
        @if(!showCandidatesExamPassed) {
        <mat-icon
          class="text-neutral-600 dark:text-neutral-300 items-center align-middle"
          >expand_circle_down</mat-icon
        >
        } @else {
        <mat-icon
          class="text-neutral-600 dark:text-neutral-300 items-center align-middle"
          >expand_circle_up</mat-icon
        >
        }
      </div>
    </div>
  </div>
  }
  <!-- EXAM OK showing -->
  @if(showCandidatesExamPassed && candidatesForJob.length >= 1){
    <div class="grid grid-cols-1 sm:grid-cols-2">
      @for(candidateOk of candidatesForJobAndExamPassed; track $index) {
        <div class="sm:flex-col-2 text-neutral-600 dark:text-neutral-300">
        -  {{ candidateOk.username }} {{ candidateOk.lastname }}
        </div>
      }
    </div>
  }





  <!-- Button to expand ThumbUp -->
  @if(candidatesWithThumbUp.length >= 1) {
  <div class="flex flex-col sm:flex-row gap-3 mt-2 font-medium">
    <div
      class="flex items-center cursor-pointer rounded-lg border py-2 px-2 border-neutral-200 dark:border-neutral-700 bg-neutral-150 dark:bg-neutral-700 text-neutral-700 dark:text-neutral-100"
      (click)="switchShowCandidatesResumeThumbUp()"
    >
      <div class="flex">
        <mat-icon class="text-neutral-700 dark:text-neutral-300"
        >thumb_up
        </mat-icon>
      </div>
      <div class="flex pl-3 ">
        {{ "recruiter.candidates_thumbUp" | transloco }} ({{ candidatesWithThumbUp.length }})
      </div>
      <div class="flex pl-3 ml-auto">
        @if(!showCandidatesThumbUp) {
        <mat-icon
          class="text-neutral-600 dark:text-neutral-300 items-center align-middle"
          >expand_circle_down</mat-icon
        >
        } @else {
        <mat-icon
          class="text-neutral-600 dark:text-neutral-300 items-center align-middle"
          >expand_circle_up</mat-icon
        >
        }
      </div>
    </div>
  </div>
  }
  <!-- ThumbUp showing -->
  @if(showCandidatesThumbUp && candidatesWithThumbUp.length >= 1){
    <div class="grid grid-cols-1 sm:grid-cols-2 mt-2">
      @for(candidate of candidatesWithThumbUp; track candidate.candidateUID) {
        <div class="sm:flex-row text-neutral-600 dark:text-neutral-300 py-2 px-1 border-b last:border-b-0 sm:border-0 border-neutral-200 dark:border-neutral-700">
          <div class="flex items-center justify-between">
            <div class="flex-grow sm:flex-grow-0 truncate overflow-hidden whitespace-nowrap pr-2">
              • {{ candidate.username }} {{ candidate.lastname }}
            </div>
            <div
              (click)="showResume(candidate)"
              class="flex cursor-pointer rounded-lg border py-1 px-2 border-neutral-200 dark:border-neutral-700 bg-neutral-150 dark:bg-neutral-700 text-neutral-700 dark:text-neutral-100 ml-auto"
            >
              <mat-icon class="text-neutral-600 dark:text-neutral-300">clinical_notes</mat-icon>
              <span class="pl-2 pr-2">{{ 'recruiter.resume' | transloco }}</span>
              @if(candidate.scoreToPosition !== null){
                <span class="">{{ candidate.scoreToPosition / 10 | number:'1.1-1'}}%</span>
              } @else {
                <span class="">"?"</span>
              }
              <!-- @if(candidate.scoreToPosition != "N/A"){
                <span class="">{{ candidate.scoreToPosition / 10 | number:'1.1-1'}}%</span>
              } -->
            </div>
            <div class="sm:grow"></div>
          </div>
        </div>
      }
    </div>
    <!-- @if (selectedResume) {
    <app-resume-viewer
      [resumeForJob]="selectedResume"
      (testEvent)="updateFromViewer()"
      (closeViewer)="selectedResume = null"
    ></app-resume-viewer>
  } -->
  }



</div>

<!-- <app-resume-viewer
  [hidden]="!selectedResume"
  [resumeForJob]="resumesForJob[0]"
  (updateResumeList)="updateFromViewer()"
  (closeViewer)="selectedResume = null"
></app-resume-viewer> -->
@if (selectedResume) {
    <app-resume-viewer
      [resumeForJob]="selectedResume"
      [jobForResume]="job"
      (updateResumeList)="updateFromViewer()"
      (closeViewer)="selectedResume = null"
    ></app-resume-viewer>
  }
