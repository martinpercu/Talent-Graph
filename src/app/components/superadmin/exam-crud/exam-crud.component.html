<div class="mx-auto max-w-3xl">
  <!-- <h1 class="text-2xl font-bold mb-4 text-gray-900 dark:text-gray-100">Manage Exams</h1> -->

  <!-- Mensaje de error -->
  <div *ngIf="errorMessage" class="bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-200 px-4 py-3 rounded mb-4">
    {{ errorMessage }}
  </div>

  <!-- Selección de examen existente -->
  <div class="mb-4">
    <label class="block text-neutral-700 dark:text-gray-300 mb-2">{{ "exam_crud.select_exam" | transloco }}</label>
    <select
      class="w-full px-3 py-2 border border-gray-300 dark:border-neutral-600 rounded-md shadow-sm bg-gray-50 dark:bg-neutral-700 text-gray-900 dark:text-gray-100 focus:ring-green-500 focus:border-green-500 dark:focus:ring-green-400 dark:focus:border-green-400"
      [ngModel]="selectedExamId"
      (change)="loadExam($event)">
      <option value="">{{ "exam_crud.new_exam" | transloco }}</option>
      <option *ngFor="let exam of exams$ | async" [value]="exam.id">{{ exam.title }}</option>
    </select>
  </div>

  <!-- Formulario de examen -->
  <div class="bg-white dark:bg-neutral-800 p-2 sm:px-8 sm:pt-4 sm:pb-6 rounded-lg shadow-xl border dark:border-neutral-600">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
      <!-- Título del examen -->
      <div>
        <label class="block text-neutral-700 dark:text-gray-300 mb-2">{{ "exam_crud.exam_title" | transloco }} *</label>
        <input
          type="text"
          [(ngModel)]="newExam.title"
          class="w-full px-3 py-2 border border-gray-300 dark:border-neutral-600 rounded-md shadow-sm bg-gray-50 dark:bg-neutral-700 text-gray-900 dark:text-gray-100 focus:ring-green-500 focus:border-green-500 dark:focus:ring-green-400 dark:focus:border-green-400"
          placeholder="{{ 'exam_crud.exam_title_placeholder' | transloco }}">
      </div>


    <!-- Select Teacher --><!-- Profesor --><!-- Select Teacher --><!-- Profesor -->
                        <!-- <div>
                          <label class="block text-neutral-700 dark:text-gray-300 mb-2">Select Teacher *</label>
                          <select
                            [(ngModel)]="newExam.teacherId"
                            (change)="updateTeacherName($event)"
                            class="w-full px-3 py-2 border border-gray-300 dark:border-neutral-600 rounded-md shadow-sm bg-gray-50 dark:bg-neutral-700 text-gray-900 dark:text-gray-100 focus:ring-green-500 focus:border-green-500 dark:focus:ring-green-400 dark:focus:border-green-400">
                            <option value="">Without Teacher</option>
                            <option *ngFor="let teacher of teachers$ | async" [value]="teacher.id">{{ teacher.name }}</option>
                          </select>
                        </div> -->
    <!-- </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"> -->

      <!-- Percentage to pass -->
      <div>
        <label class="block text-neutral-700 dark:text-gray-300 mb-2">{{ 'exam_crud.percentage_pass' | transloco }}</label>
        <input
          type="number"
          [(ngModel)]="newExam.passingPercentage"
          class="w-full px-3 py-2 border border-gray-300 dark:border-neutral-600 rounded-md shadow-sm bg-gray-50 dark:bg-neutral-700 text-gray-900 dark:text-gray-100 focus:ring-green-500 focus:border-green-500 dark:focus:ring-green-400 dark:focus:border-green-400"
          min="0"
          max="100">
      </div>

      <!-- Tiempo de espera para reintentar -->
      <div>
        <label class="block text-neutral-700 dark:text-gray-300 mb-2">{{ 'exam_crud.waitning_time' | transloco }}</label>
        <input
          type="number"
          [(ngModel)]="newExam.timeToWait"
          class="w-full px-3 py-2 border border-gray-300 dark:border-neutral-600 rounded-md shadow-sm bg-gray-50 dark:bg-neutral-700 text-gray-900 dark:text-gray-100 focus:ring-green-500 focus:border-green-500 dark:focus:ring-green-400 dark:focus:border-green-400"
          min="0">
      </div>

      <!-- Tiempo para hacer el examen -->
      <div>
        <label class="block text-neutral-700 dark:text-gray-300 mb-2">{{ 'exam_crud.time_to_complete' | transloco }}</label>
        <input
          type="number"
          [(ngModel)]="newExam.timeToDoTheExam"
          class="w-full px-3 py-2 border border-gray-300 dark:border-neutral-600 rounded-md shadow-sm bg-gray-50 dark:bg-neutral-700 text-gray-900 dark:text-gray-100 focus:ring-green-500 focus:border-green-500 dark:focus:ring-green-400 dark:focus:border-green-400"
          min="1">
      </div>



    <!-- Nuevos campos -->

      <!-- enable ??  Always ENABLE == TRUE -->

      <!-- <div class="flex flex-row items-center">
        <label class="block text-neutral-700 dark:text-gray-300">{{ 'exam_crud.exam_status' | transloco }}</label>
        <div class="flex items-center ml-4">
          <input
            type="checkbox"
            [(ngModel)]="newExam.enable"
            class="w-5 h-5 text-blue-600 dark:text-blue-400 border-gray-300 dark:border-neutral-600 rounded focus:ring-blue-500 dark:focus:ring-blue-400">
          <span class="ml-2 text-neutral-700 dark:text-gray-300">{{ 'exam_crud.enable' | transloco }}</span>
        </div>
      </div> -->

      <!-- Tiempo para hacer el examen -->
      <!-- <div>
        <label class="block text-neutral-700 dark:text-gray-300 mb-2">Time to complete the exam (minutes)</label>
        <input
          type="number"
          [(ngModel)]="newExam.timeToDoTheExam"
          class="w-full px-3 py-2 border border-gray-300 dark:border-neutral-600 rounded-md shadow-sm bg-gray-50 dark:bg-neutral-700 text-gray-900 dark:text-gray-100 focus:ring-green-500 focus:border-green-500 dark:focus:ring-green-400 dark:focus:border-green-400"
          min="1">
      </div> -->
    </div>

    <!-- Preguntas -->
    <div class="mb-6">
      <div class="flex justify-between items-center mb-2">
        <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100">{{ 'exam_crud.questions' | transloco }}</h2>
        <div *ngIf="!newExam.questions?.length" class="text-gray-500 dark:text-gray-400 text-center py-4">
          {{ 'exam_crud.no_question_added' | transloco }}
        </div>
        <button
          type="button"
          (click)="addQuestion()"
          class="bg-blue-500 hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-700 text-white px-3 py-1 rounded-md">
          {{ 'exam_crud.add_question' | transloco }}
        </button>
      </div>

      <!-- <div *ngIf="!newExam.questions?.length" class="text-gray-500 dark:text-gray-400 text-center py-4">
        {{ 'exam_crud.no_question_added' | transloco }}
      </div> -->

      <div *ngFor="let question of newExam.questions; let i = index" class="border border-gray-300 dark:border-neutral-600 p-4 rounded-md mb-4 bg-gray-50 dark:bg-neutral-700">
        <div class="flex justify-between items-start mb-3">
          <h3 class="font-medium text-gray-900 dark:text-gray-100">{{ 'exam_crud.question' | transloco }} {{ i + 1 }}</h3>
          <button
            type="button"
            (click)="removeQuestion(i)"
            class="text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300">
            <mat-icon>delete</mat-icon>
          </button>
        </div>

        <div class="mb-3">
          <input
            type="text"
            [(ngModel)]="question.text"
            class="w-full px-3 py-2 border border-gray-300 dark:border-neutral-600 rounded-md shadow-sm bg-white dark:bg-neutral-600 text-gray-900 dark:text-gray-100 focus:ring-green-500 focus:border-green-500 dark:focus:ring-green-400 dark:focus:border-green-400"
            placeholder="Texto de la pregunta">
        </div>

        <div class="mb-2">
          <div class="flex justify-between items-center">
            <h4 class="font-medium text-gray-900 dark:text-gray-100">{{ 'exam_crud.options' | transloco }}</h4>
            <button
              *ngIf="question.options.length < 6"
              type="button"
              (click)="addOption(i)"
              class="text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300">
              <mat-icon>add_circle</mat-icon>
            </button>
          </div>
        </div>

        <div *ngFor="let option of question.options; let j = index" class="flex items-center mb-2">
          <input
            type="radio"
            [checked]="option.isCorrect"
            (change)="updateOptionCorrectness(i, j)"
            class="mr-2 text-green-600 dark:text-green-400 focus:ring-green-500 dark:focus:ring-green-400">
          <input
            type="text"
            [(ngModel)]="option.text"
            class="flex-grow px-3 py-2 border border-gray-300 dark:border-neutral-600 rounded-md shadow-sm bg-white dark:bg-neutral-600 text-gray-900 dark:text-gray-100 focus:ring-green-500 focus:border-green-500 dark:focus:ring-green-400 dark:focus:border-green-400"
            placeholder="Texto de la opción">
          <button
            *ngIf="question.options.length > 2"
            type="button"
            (click)="removeOption(i, j)"
            class="ml-2 text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300">
            <mat-icon>remove_circle</mat-icon>
          </button>
        </div>
      </div>
    </div>

    <!-- Botones -->
    <div class="flex justify-between">
      <div>
        <button
          type="button"
          (click)="resetForm()"
          class="bg-gray-300 hover:bg-gray-400 dark:bg-neutral-600 dark:hover:bg-neutral-700 text-neutral-800 dark:text-gray-200 px-4 py-2 rounded-md mr-2">
          {{ 'exam_crud.clean' | transloco }}
        </button>
        <button
          *ngIf="editingExamId"
          type="button"
          (click)="deleteExam()"
          class="bg-red-500 hover:bg-red-600 dark:bg-red-600 dark:hover:bg-red-700 text-white px-4 py-2 rounded-md"
          [disabled]="isSaving">
          {{ 'exam_crud.delete' | transloco }}
        </button>
      </div>
      <button
        type="button"
        (click)="saveExam()"
        class="bg-green-500 hover:bg-green-600 dark:bg-green-600 dark:hover:bg-green-700 text-white px-4 py-2 rounded-md"
        [disabled]="isSaving">
        {{ editingExamId ? ('exam_crud.update' | transloco) : 'Guardar' }}
      </button>
    </div>
  </div>
</div>





<!-- ALL UNDER IS ALL HIDDEN -->

<div class="container mx-auto p-4 hidden">
  <h1 class="text-2xl font-bold mb-4">Manage Exams</h1>

  <!-- Mensaje de error -->
  <div *ngIf="errorMessage" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
    {{ errorMessage }}
  </div>

  <!-- Selección de examen existente -->
  <div class="mb-4">
    <label class="block text-neutral-700 mb-2">Select Exam</label>
    <select
      class="w-full px-3 py-2 border rounded-md"
      [ngModel]="selectedExamId"
      (change)="loadExam($event)">
      <option value="">New exam</option>
      <option *ngFor="let exam of exams$ | async" [value]="exam.id">{{ exam.title }}</option>
    </select>
  </div>

  <!-- Formulario de examen -->
  <div class="bg-white shadow-md rounded-md p-6">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
      <!-- Título del examen -->
      <div>
        <label class="block text-neutral-700 mb-2">Title *</label>
        <input
          type="text"
          [(ngModel)]="newExam.title"
          class="w-full px-3 py-2 border rounded-md"
          placeholder="Exam Title">
      </div>

      <!-- Profesor -->
      <div>
        <label class="block text-neutral-700 mb-2">Select a Teacher *</label>
        <select
          [(ngModel)]="newExam.teacherId"
          (change)="updateTeacherName($event)"
          class="w-full px-3 py-2 border rounded-md">
          <option value="">Without Teacher</option>
          <option *ngFor="let teacher of teachers$ | async" [value]="teacher.id">{{ teacher.name }}</option>
        </select>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
      <!-- Percentage to pass -->
      <div>
        <label class="block text-neutral-700 mb-2">Percentage to pass</label>
        <input
          type="number"
          [(ngModel)]="newExam.passingPercentage"
          class="w-full px-3 py-2 border rounded-md"
          min="0"
          max="100">
      </div>

      <!-- Tiempo de espera para reintentar -->
      <div>
        <label class="block text-neutral-700 mb-2">Waiting time (minutes)</label>
        <input
          type="number"
          [(ngModel)]="newExam.timeToWait"
          class="w-full px-3 py-2 border rounded-md"
          min="0">
      </div>
    </div>

    <!-- Nuevos campos -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
      <!-- enable ?? -->
      <div>
        <label class="block text-neutral-700 mb-2">Exam status</label>
        <div class="flex items-center">
          <input
            type="checkbox"
            [(ngModel)]="newExam.enable"
            class="w-5 h-5 text-blue-600">
          <span class="ml-2">Enable</span>
        </div>
      </div>

      <!-- Tiempo para hacer el examen -->
      <div>
        <label class="block text-neutral-700 mb-2">Time to complete the exam (minutes)</label>
        <input
          type="number"
          [(ngModel)]="newExam.timeToDoTheExam"
          class="w-full px-3 py-2 border rounded-md"
          min="1">
      </div>
    </div>

    <!-- Preguntas -->
    <div class="mb-6">
      <div class="flex justify-between items-center mb-2">
        <h2 class="text-lg font-semibold">Preguntas</h2>
        <button
          type="button"
          (click)="addQuestion()"
          class="bg-blue-500 text-white px-3 py-1 rounded-md hover:bg-blue-600">
          Add Question
        </button>
      </div>

      <div *ngIf="!newExam.questions?.length" class="text-gray-500 text-center py-4">
        There are no questions added
      </div>

      <div *ngFor="let question of newExam.questions; let i = index" class="border p-4 rounded-md mb-4">
        <div class="flex justify-between items-start mb-3">
          <h3 class="font-medium">Question {{ i + 1 }}</h3>
          <button
            type="button"
            (click)="removeQuestion(i)"
            class="text-red-500 hover:text-red-700">
            <mat-icon>delete</mat-icon>
          </button>
        </div>

        <div class="mb-3">
          <input
            type="text"
            [(ngModel)]="question.text"
            class="w-full px-3 py-2 border rounded-md"
            placeholder="Texto de la pregunta">
        </div>

        <div class="mb-2">
          <div class="flex justify-between items-center">
            <h4 class="font-medium">Options</h4>
            <button
              *ngIf="question.options.length < 6"
              type="button"
              (click)="addOption(i)"
              class="text-blue-500 hover:text-blue-700">
              <mat-icon>add_circle</mat-icon>
            </button>
          </div>
        </div>

        <div *ngFor="let option of question.options; let j = index" class="flex items-center mb-2">
          <input
            type="radio"
            [checked]="option.isCorrect"
            (change)="updateOptionCorrectness(i, j)"
            class="mr-2">
          <input
            type="text"
            [(ngModel)]="option.text"
            class="flex-grow px-3 py-2 border rounded-md"
            placeholder="Texto de la opción">
          <button
            *ngIf="question.options.length > 2"
            type="button"
            (click)="removeOption(i, j)"
            class="ml-2 text-red-500 hover:text-red-700">
            <mat-icon>remove_circle</mat-icon>
          </button>
        </div>
      </div>
    </div>

    <!-- Botones -->
    <div class="flex justify-between">
      <div>
        <button
          type="button"
          (click)="resetForm()"
          class="bg-gray-300 text-neutral-800 px-4 py-2 rounded-md hover:bg-gray-400 mr-2">
          Clean
        </button>
        <button
          *ngIf="editingExamId"
          type="button"
          (click)="deleteExam()"
          class="bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600"
          [disabled]="isSaving">
          Delete
        </button>
      </div>
      <button
        type="button"
        (click)="saveExam()"
        class="bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600"
        [disabled]="isSaving">
        {{ editingExamId ? 'Actualizar' : 'Guardar' }}
      </button>
    </div>
  </div>
</div>

